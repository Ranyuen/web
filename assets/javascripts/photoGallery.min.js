!function(a){"use struct";function b(a,b){var c=Date.now();return(!b||0>=b)&&(b=1e3/30),function(){var d=Date.now();c+b>d||(c=d,a.apply(null,arguments))}}function c(){this.rootNode=null,this.currentPage=1,this._masonry=null,this._lockLoadingNextPage=!1,this._lastPhotoNode=null}Date.now||(Date.now=function(){(new Date).getTime()}),Array.from||(Array.from=function(a){return[].slice.call(a)}),a.requestAnimationFrame||(a.requestanimationframe=a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.msRequestAnimationFrame||a.oRequestAnimationFrame||a.khtmlRequestAnimationFrame),c.prototype.init=function(a){this.rootNode=a,this._masonry=new Masonry(a,{columnWidth:".photo",gutter:0,itemSelector:".photo",hiddenStyle:{opacity:0},visibleStyle:{opacity:1},transitionDuration:"0.8s"}),window.onscroll=b(this.onscroll.bind(this)),this.applied()},c.prototype.applied=function(){$(".lightbox").colorbox({rel:"gallery",fixed:!0,height:"90%",transition:"elastic",speed:360,width:"90%"}),this._lastPhotoNode=this.rootNode.querySelector(".photo:last-of-type")},c.prototype.onscroll=function(){document.documentElement.clientHeight>this._lastPhotoNode.getBoundingClientRect().top&&this.loadNextpage()},c.prototype.loadNextpage=function(){var a,b,c=this;this._lockLoadingNextPage||(this._lockLoadingNextPage=!0,b=""+URI("/api/photos/").addSearch(URI(location.href).search(!0)).addSearch({limit:20,offset:20*this.currentPage}),a=new XMLHttpRequest,a.open("GET",b),a.send(),a.onreadystatechange=function(){var b;if(4===a.readyState){if(c._lockLoadingNextPage=!1,200!==a.status)return console.error([a.status,a]);try{b=JSON.parse(a.responseText)}catch(d){return console.error([d,a.responseText])}++c.currentPage,c.insertPhotoNodes(b.map(function(a){var b=349,c=~~(a.height*b/a.width);return a.thumb_width=b,a.thumb_height=c,a}))}})},c.prototype.insertPhotoNodes=function(a){var b=[],c=document.createDocumentFragment();a.forEach(function(a){var d=document.createElement("div");d.classList.add("photo"),a.alt=a.description_ja+" 蘭裕園 Ranyuen",a.origUrl="/Calanthe/gallery/"+a.id+".jpg",a.thumbUrl="/api/photo?format=jpeg&id="+a.id+"&width="+a.thumb_width,d.innerHTML=Hogan.compile('<a class="lightbox" href="{{origUrl}}" title="{{alt}}"><img rel="gallery" src="{{thumbUrl}}" width="{{thumb_width}}" height="{{thumb_height}}" alt="{{alt}}"/></a><div>{{description_ja}}</div><div>{{description_en}}</div>').render(a),c.appendChild(d),b.push(d)}),this.rootNode.appendChild(c),this._masonry.appended(b),this.applied()},a.PhotoGallery=c}((this||0).self||global);
//# sourceMappingURL=photoGallery.min.js.map